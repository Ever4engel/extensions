(()=>{"use strict";function t(t){return document.querySelector(`#downloader-setting .${t}`)}function n(t){return new Promise((n=>{const e=new XMLHttpRequest;e.open("GET",t),e.responseType="arraybuffer",e.onload=()=>n(e.response),e.send()}))}function e(t=0){return new Promise((n=>setTimeout((()=>n()),t)))}let o=0,i=0;function r(){i=0}function a(){i=0,o++}function s(){o--,o<0&&(o=0),0===o&&r&&r()}const c=new WeakSet,d=[];!function(){const t=XMLHttpRequest.prototype.send,n=XMLHttpRequest.prototype.open;XMLHttpRequest.prototype.open=function(t,e,...o){return d.some((t=>e.startsWith(t)))&&c.add(this),n.call(this,t,e,...o)},XMLHttpRequest.prototype.send=function(...n){return c.has(this)||a(),this.addEventListener("readystatechange",(()=>{4===this.readyState&&(c.has(this)||s())})),t.call(this,...n)}}();const l=new Set;window.addEventListener("message",(t=>{const n=t.data;n&&("request-end"===n.type&&l.has(n.requestId)?(l.delete(n.requestId),s()):"request-start"===n.type&&(l.add(n.requestId),a()))}),!1);const u=window.fetch;window.fetch=async function(t,...n){const e="string"==typeof t?t:t.url,o=u.call(this,t,...n);d.some((t=>e.startsWith(t)))||(a(),o.finally((()=>s())));const i=await o;return["blob","arrayBuffer","text","json"].forEach((t=>{const n=Response.prototype[t];i[t]=function(){const t=n.call(this);return a(),t.finally((()=>s())),t}})),i};const h=[],p=CanvasRenderingContext2D.prototype.drawImage;async function f(n){if(n.startsWith("data:image/png")){const t=await new Promise((t=>{const e=new Image;e.onload=()=>t(e),e.src=n})),e=document.createElement("canvas");e.width=t.naturalWidth,e.height=t.naturalHeight;const o=e.getContext("2d");p.call(o,t,0,0),n=e.toDataURL("image/jpeg",1)}for(let t=0;t<3;++t)if(h[h.length-1-t]===n)return!1;return r(),h.push(n),t("captureNum").textContent=`${h.length}`,t("preview").src=n,!0}function g(){return h}const v=HTMLCanvasElement.prototype.toDataURL;var w=function(t){return URL.createObjectURL(new Blob([t],{type:"text/javascript"}))};try{URL.revokeObjectURL(w(""))}catch(t){w=function(t){return"data:application/javascript;charset=UTF-8,"+encodeURI(t)}}var y=Uint8Array,m=Uint16Array,b=Uint32Array,x=new y([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),L=new y([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),E=(new y([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),function(t,n){for(var e=new m(31),o=0;o<31;++o)e[o]=n+=1<<t[o-1];var i=new b(e[30]);for(o=1;o<30;++o)for(var r=e[o];r<e[o+1];++r)i[r]=r-e[o]<<5|o;return[e,i]}),k=E(x,2),R=k[0],C=k[1];R[28]=258,C[258]=28;for(var I=E(L,0),U=(I[0],I[1],new m(32768)),q=0;q<32768;++q){var D=(43690&q)>>>1|(21845&q)<<1;D=(61680&(D=(52428&D)>>>2|(13107&D)<<2))>>>4|(3855&D)<<4,U[q]=((65280&D)>>>8|(255&D)<<8)>>>1}var S=new y(288);for(q=0;q<144;++q)S[q]=8;for(q=144;q<256;++q)S[q]=9;for(q=256;q<280;++q)S[q]=7;for(q=280;q<288;++q)S[q]=8;var A=new y(32);for(q=0;q<32;++q)A[q]=5;var M=new y(0),T=function(){for(var t=new b(256),n=0;n<256;++n){for(var e=n,o=9;--o;)e=(1&e&&3988292384)^e>>>1;t[n]=e}return t}(),j=function(t,n,e){for(;e;++n)t[n]=e,e>>>=8},B="undefined"!=typeof TextEncoder&&new TextEncoder,H="undefined"!=typeof TextDecoder&&new TextDecoder;try{H.decode(M,{stream:!0})}catch(t){}function P(t,n){if(n){for(var e=new y(t.length),o=0;o<t.length;++o)e[o]=t.charCodeAt(o);return e}if(B)return B.encode(t);var i=t.length,r=new y(t.length+(t.length>>1)),a=0,s=function(t){r[a++]=t};for(o=0;o<i;++o){if(a+5>r.length){var c=new y(a+8+(i-o<<1));c.set(r),r=c}var d=t.charCodeAt(o);d<128||n?s(d):d<2048?(s(192|d>>6),s(128|63&d)):d>55295&&d<57344?(s(240|(d=65536+(1047552&d)|1023&t.charCodeAt(++o))>>18),s(128|d>>12&63),s(128|d>>6&63),s(128|63&d)):(s(224|d>>12),s(128|d>>6&63),s(128|63&d))}return function(t,n,e){(null==n||n<0)&&(n=0),(null==e||e>t.length)&&(e=t.length);var o=new(t instanceof m?m:t instanceof b?b:y)(e-n);return o.set(t.subarray(n,e)),o}(r,0,a)}var X=function(t){var n=0;if(t)for(var e in t){var o=t[e].length;if(o>65535)throw"extra field too long";n+=o+4}return n},z=function(t,n,e,o,i,r,a,s){var c=o.length,d=e.extra,l=s&&s.length,u=X(d);j(t,n,null!=a?33639248:67324752),n+=4,null!=a&&(t[n++]=20,t[n++]=e.os),t[n]=20,n+=2,t[n++]=e.flag<<1|(null==r&&8),t[n++]=i&&8,t[n++]=255&e.compression,t[n++]=e.compression>>8;var h=new Date(null==e.mtime?Date.now():e.mtime),p=h.getFullYear()-1980;if(p<0||p>119)throw"date not in range 1980-2099";if(j(t,n,p<<25|h.getMonth()+1<<21|h.getDate()<<16|h.getHours()<<11|h.getMinutes()<<5|h.getSeconds()>>>1),n+=4,null!=r&&(j(t,n,e.crc),j(t,n+4,r),j(t,n+8,e.size)),j(t,n+12,c),j(t,n+14,u),n+=16,null!=a&&(j(t,n,l),j(t,n+6,e.attrs),j(t,n+10,a),n+=14),t.set(o,n),n+=c,u)for(var f in d){var g=d[f],v=g.length;j(t,n,+f),j(t,n+2,v),t.set(g,n+4),n+=4+v}return l&&(t.set(s,n),n+=l),n},W=function(){function t(t){var n;this.filename=t,this.c=(n=-1,{p:function(t){for(var e=n,o=0;o<t.length;++o)e=T[255&e^t[o]]^e>>>8;n=e},d:function(){return~n}}),this.size=0,this.compression=0}return t.prototype.process=function(t,n){this.ondata(null,t,n)},t.prototype.push=function(t,n){if(!this.ondata)throw"no callback - add to ZIP archive before pushing";this.c.p(t),this.size+=t.length,n&&(this.crc=this.c.d()),this.process(t,n||!1)},t}(),$=function(){function t(t){this.ondata=t,this.u=[],this.d=1}return t.prototype.add=function(t){var n=this;if(2&this.d)throw"stream finished";var e=P(t.filename),o=e.length,i=t.comment,r=i&&P(i),a=o!=t.filename.length||r&&i.length!=r.length,s=o+X(t.extra)+30;if(o>65535)throw"filename too long";var c=new y(s);z(c,0,t,e,a);var d=[c],l=function(){for(var t=0,e=d;t<e.length;t++){var o=e[t];n.ondata(null,o,!1)}d=[]},u=this.d;this.d=0;var h=this.u.length,p=function(t,n){var e={};for(var o in t)e[o]=t[o];for(var o in n)e[o]=n[o];return e}(t,{f:e,u:a,o:r,t:function(){t.terminate&&t.terminate()},r:function(){if(l(),u){var t=n.u[h+1];t?t.r():n.d=1}u=1}}),f=0;t.ondata=function(e,o,i){if(e)n.ondata(e,o,i),n.terminate();else if(f+=o.length,d.push(o),i){var r=new y(16);j(r,0,134695760),j(r,4,t.crc),j(r,8,f),j(r,12,t.size),d.push(r),p.c=f,p.b=s+f+16,p.crc=t.crc,p.size=t.size,u&&p.r(),u=1}else u&&l()},this.u.push(p)},t.prototype.end=function(){var t=this;if(2&this.d){if(1&this.d)throw"stream finishing";throw"stream finished"}this.d?this.e():this.u.push({r:function(){1&t.d&&(t.u.splice(-1,1),t.e())},t:function(){}}),this.d=3},t.prototype.e=function(){for(var t=0,n=0,e=0,o=0,i=this.u;o<i.length;o++)e+=46+(c=i[o]).f.length+X(c.extra)+(c.o?c.o.length:0);for(var r=new y(e+22),a=0,s=this.u;a<s.length;a++){var c=s[a];z(r,t,c,c.f,c.u,c.c,n,c.o),t+=46+c.f.length+X(c.extra)+(c.o?c.o.length:0),n+=c.b}var d,l,u,h,p;d=r,l=t,u=this.u.length,h=e,p=n,j(d,l,101010256),j(d,l+8,u),j(d,l+10,u),j(d,l+12,h),j(d,l+16,p),this.ondata(null,r,!0),this.d=2},t.prototype.terminate=function(){for(var t=0,n=this.u;t<n.length;t++)n[t].t();this.d=2},t}();function O(t,n){t.addEventListener("mousedown",(t=>t.stopPropagation())),t.addEventListener("click",(e=>{e.stopPropagation(),t.classList.contains("disabled")||n()}))}window.Image=class extends window.Image{constructor(){super(),this.crossOrigin="Anonymous"}},async function(r,a,s){await async function(r,a){await new Promise((t=>{"complete"===document.readyState||"interactive"===document.readyState?setTimeout((()=>t()),0):document.addEventListener("DOMContentLoaded",(()=>t()))}));const s=document.createElement("div");s.innerHTML='<div id="downloader-setting">\n  <style>\n    #downloader-setting {\n      position: fixed;\n      z-index: 99999;\n      top: 0;\n      right: 0;\n      padding: 16px;\n      margin: 12px;\n      background: white;\n      border-radius: 8px;\n      box-shadow: 0 0 5px lightgray;\n      color: black;\n    }\n    #downloader-setting img {\n      width: 220px !important;\n    }\n    #downloader-setting div {\n      padding: 6px 0;\n    }\n    #downloader-setting .button,\n    #downloader-setting .checkbox {\n      cursor: pointer;\n      padding: 10px 15px;\n      display: inline-block;\n    }\n    #downloader-setting .button {\n      border: 1px solid lightgray;\n    }\n    #downloader-setting .button.disabled {\n      cursor: default;\n      background-color: #E7E7E7;\n      color: #BBB;\n    }\n    #downloader-setting .checkbox > .box {\n      border: 1px solid grey;\n      display: inline-block;\n      width: 20px;\n      height: 20px;\n      margin-right: 8px;\n      vertical-align: middle;\n    }\n  </style>\n  <div>Captured images: <span class="captureNum"></span></div>\n  <div>Preview:<br /><img class="preview" /></div>\n  <div class="buttons">\n    <div class="save-container">\n      <div>\n        <div class="button auto">Auto Download All</div>\n      </div>\n      <div>\n        <div class="button auto-limit">Auto With Pages Limit</div>\n      </div>\n    </div>\n    <div class="l2r-container" style="display: none;">\n      <div class="checkbox l2r">\n        <div class="box"></div>\n        Left to Right\n      </div>\n    </div>\n    <div>\n      <div class="button download">Save</div>\n    </div>\n  </div>\n  <div class="auto-working" style="display: none">Automatically Downloading...</div>\n  <div class="progress" style="display:none">\n    Compress: <span class="current"></span> / <span class="total"></span>\n  </div>\n</div>\n',document.body.prepend(s);let c=null;const d=[0,0];async function l(n=1/0){t("buttons").style.display="none",t("auto-working").style.display="block",await async function(t,n){for(;;){if(i>=12||g().length>=n)return;if(await e(1e3),0===o)try{await t()&&(i=0),i++}catch(t){}}}(r,n),t("save-container").style.display="none",t("l2r-container").style.display="none",t("buttons").style.display="block",t("button.download").classList.remove("disabled"),t("auto-working").style.display="none",document.body.style.pointerEvents=""}document.getElementById("downloader-setting").addEventListener("mousedown",(t=>{c=[t.pageX,t.pageY]})),window.addEventListener("mouseup",(()=>{c=null})),window.addEventListener("mousemove",(t=>{if(c){const n=[t.pageX,t.pageY];d[0]+=n[0]-c[0],d[1]+=n[1]-c[1],document.getElementById("downloader-setting").style.transform=`translate(${d[0]}px, ${d[1]}px)`,c=n}})),O(t("auto"),(()=>l())),O(t("auto-limit"),(()=>{const t=window.prompt("How many pages?","10");null!==t&&l(parseInt(t,10))}));const u=t("l2r");O(u,(()=>{const t=u.querySelector(".box");t.style.background=t.style.background?"":"darkblue"})),O(t("download"),(async()=>{t("button.download").classList.add("disabled"),t("progress").style.display="inline-block",t("progress .total").textContent=g().length.toString(),t("progress .current").textContent="0";const e=await async function(e,o){return new Promise((o=>{const i=[],r=new $(((t,n,e)=>{if(!t&&(i.push(n),e)){const t=window.URL.createObjectURL(new Blob(i));o(t)}})),a=`${e.length}`.length;(async()=>{for(let i=0;i<e.length;++i){const s=new W(`${(i+1).toString().padStart(a,"0")}.jpg`);r.add(s),s.push(new Uint8Array(await n(e[i])),!0),o=`${i+1}`,t("progress .current").textContent=o}var o;r.end()})()}))}(g()),o=document.createElement("a");o.href=e,o.download=document.title+".zip",o.click(),t("progress").style.display="none",a&&a(),t("button.download").classList.remove("disabled")}))}((async()=>{const n=!!t("l2r > .box").style.background;for(const t of["viewport0","viewport1"]){const n=document.getElementById(t);n&&"hidden"!==n.style.visibility&&f(n.querySelector("canvas").clip.toDataURL("image/jpeg",1))}const e=document.getElementById("viewer"),o=n?window.innerWidth-19:19,i=new MouseEvent("mousedown",{clientX:o,clientY:474}),r=new MouseEvent("click",{clientX:o,clientY:474});e.dispatchEvent(i),e.dispatchEvent(r)}),void 0),function(t){const n=CanvasRenderingContext2D.prototype.drawImage;CanvasRenderingContext2D.prototype.drawImage=function(e,...o){const i=t.call(this,e,...o);return i&&async function(t){if(t.width<=300&&t.height<=150)return;const n=t&&v.call(t,"image/jpeg",1)||"";await f(n)}(i),n.call(this,e,...o)}}((function(t,...n){if(8===n.length&&n[6]>32&&n[7]>32)if(t.clip)this.canvas.clip=t.clip;else if(1===document.querySelectorAll("canvas.dummy[width]").length||this.canvas.classList.contains("dummy")){const e=function(t,n,e){const o=document.createElement("canvas");o.width=n,o.height=e;const i=o.getContext("2d");return p.call(i,t,0,0),o}(t,n[2],n[3]);this.canvas.clip=e}return null}))}().then((()=>t("l2r-container").style.display="block"))})();